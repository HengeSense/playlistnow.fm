{% spaceless %}
{% load i18n %}
{% load comments %}
{% load cache %}
{% load music_tags %}
{% load playlist_tags %}
{% endspaceless %}
{% if activity.open %}
<div class="lineFeed">
    <div class="lineFeedAvatar">
        <a href="{% url user_details activity.actor.username %}" title="{% trans "details of user" %} {{ activity.actor }}">
            <img src="{{ activity.actor.playlistprofile.avatar_url }}" class="avatar small left espace" />
        </a>
    </div>
    <div class="lineFeedContent">
{% endif %}

        <div class="lineFeedContentWhat">
{% if activity.verb == 'recommends' %}
    <a href="{% url user_details activity.actor.username %}" title="{% trans "see details of user" %} {{ activity.actor }}" class="bold">
        {{ activity.actor }}
    </a>
    recommends this track to
    <a href="{{ activity.action_object.target.get_absolute_url }}" title="{% trans "details of" %} {{ activity.action_object.target }}" class="bold">
        {{ activity.action_object.target }}
    </a>
    {% with activity.action_object.track as track %}
    {% render_track track '' request %}
    {% endwith %}
{% endif %}
{% if activity.verb == 'added track to playlist' %}
    {% if activity.open %}
        <a href="{% url user_details activity.actor.username %}" title="{% trans "see details of user" %} {{ activity.actor }}" class="bold">
            {{ activity.actor }}
        </a>
        added to playlist
        <a href="{{ activity.target.get_absolute_url }}" title="{% trans "details of" %} {{ activity.target }}" class="bold">
            {{ activity.target }}
        </a>
        {% if activity.close %}
        this track
        {% else %}
        this tracks
        {% endif %}
    {% endif %}
    {% if activity.close %}
        {% render_tracks activity.action_object_group '' request %}
    {% endif %}
{% endif %}
{% if activity.verb == 'becomes fan of artist' %}
    {% if activity.open %}
        <a href="{% url user_details activity.actor.username %}" title="{% trans "see details of user" %} {{ activity.actor }}" class="bold">
            {{ activity.actor }}
        </a>
        {% if activity.close %}
        is fan of this artist
        {% else %}
        is fan of this artists
        {% endif %}
    {% endif %}
    {% if activity.close %}
        {% render_artists activity.action_object_group %}
        <div class="clear"></div>
    {% endif %}
{% endif %}
{% if activity.verb == 'liked track' %}
    {% if activity.open %}
        <a href="{% url user_details activity.actor.username %}" title="{% trans "see details of user" %} {{ activity.actor }}" class="bold">
            {{ activity.actor }}
        </a>
        {% if activity.close %}
        likes this track
        {% else %}
        likes these tracks
        {% endif %}
    {% endif %}
    {% if activity.close %}
        {% if activity.action_object_group %}
        {% render_tracks activity.action_object_group '' request %}
        {% else %}
        {% render_track activity.action_object '' request %}
        {% endif %}
    {% endif %}
{% endif %}
{% if activity.verb == 'started following' %}
    <a href="{% url user_details activity.actor.username %}" title="{% trans "see details of user" %} {{ activity.actor }}" class="bold">
        {{ activity.actor }}
    </a>
    {{ activity.verb }}
    <a href="{{ activity.target.get_absolute_url }}" title="{% trans "details of" %} {{ activity.target }}" class="bold">
        {{ activity.target.first_name }}
        {{ activity.target.last_name }}
    </a>
{% endif %}
{% if activity.verb == 'bookmarks playlist' %}
    <a href="{% url user_details activity.actor.username %}" title="{% trans "see details of user" %} {{ activity.actor }}" class="bold">
        {{ activity.actor }}
    </a>
    {{ activity.verb }}
    <a href="{{ activity.action_object.get_absolute_url }}" title="{% trans "details of" %} {{ activity.action_object }}" class="bold">
        {{ activity.action_object }}
    </a>
{% endif %}
{% if activity.verb == 'created playlist' %}
    <a href="{% url user_details activity.actor.username %}" title="{% trans "see details of user" %} {{ activity.actor }}" class="bold">
        {{ activity.actor }}
    </a>
    {{ activity.verb }}
    <a href="{{ activity.target.get_absolute_url }}" title="{% trans "details of" %} {{ activity.target }}" class="bold">
        {{ activity.target }}
    </a>
{% endif %}
{% if activity.verb == 'thanks recommendation' %}
    <a class="bold" href="{{ activity.actor.get_absolute_url }}" title="{% trans "details of user" %} {{ activity.actor }}">{{ activity.actor }}</a>
    thanks
    <a class="bold" href="{{ activity.action_object.source.get_absolute_url }}" title="{% trans "details of user" %} {{ activity.action_object.source }}">{{ activity.action_object.source }}</a>
    for recommending this track:
    {% with activity.action_object.track as track %}
    {% render_track track '' request %}
    {% endwith %}
{% endif %}

{% if request.user.is_authenticated and request.user == activity.actor %}
            <span class="delete action_pk_{{ activity.pk }}">&nbsp;</span>
{% endif %}
        </div>
{% if activity.close %}
        {% get_comment_count for activity as comment_count %}
        <div class="lineFeedContentWhen"> 
            {{ action.timestamp|timesince }} ago -
            {% if action in request.user.playlistprofile.fanof_actions.all %}
            <a class="authenticationRequired" href="{% url action_unlike action.pk %}">Unlike</a>
            {% else %}
            <a class="authenticationRequired" href="{% url action_like action.pk %}">I Like</a>
            {% endif %}
            {% if activity.verb == 'recommends' and request.user == activity.action_object.target and not activity.action_object.thanks %}
            <span>
            - <a class="delete parent" href="{% url music_recommendation_thank activity.action_object.pk %}">Thank</a>
            </span>
            {% endif %}
            - 
            <a class="ui_ignore comment_form_toggle" href="">Comment (<strong>{{ comment_count }}</strong>)</a>

            {% if action.fans.count %}
            <div class="topcomments"></div>
            <div class="likes">
            <img src="{{ STATIC_URL }}images/not_newthumbup.png" class="espace">
                {% for fan in action.fans.all %}
                <a href="{% url user_details fan.user.username %}">{{ fan.user }}</a> likes it
                {% endfor %}
            </div>
            {% endif %}

            {% render_comment_list for activity %}
        
            <div style="{% if not comment_count %}display: none{% endif %}" class="comment_form_contents" >
            {% render_comment_form for activity %}
            </div>
        </div>
    </div>
    <div class="clear"></div>
</div>
{% endif %}
