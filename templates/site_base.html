{% load i18n %}
{% if not request.ajax %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
{% block html_declare %}
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" >
{% endblock %}
<head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <!-- core css -->
    <link rel="stylesheet" href="{{ STATIC_URL }}local/reset.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}local/screen.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}local/prod.css" />
    {% if empty %}
    <!-- core js -->
    <script src="{% block jquery_src %}{{ STATIC_URL }}jquery.min.js{% endblock %}" type="text/javascript"></script>
    <script type="text/javascript">
    var STATIC_URL = '{{ STATIC_URL }}';
    var music_search_autocomplete = '{% url music_search_autocomplete %}';
    var playlist_track_modify = '{% url playlist_track_modify %}';
    var popup_auth = '{% url acct_login %}';
    </script>
    <script type="text/javascript" src="{{ STATIC_URL }}local/core.js"></script>
    <script type="text/javascript">
    var user = {
        'is_authenticated': {% if request.user.is_authenticated %}true{% else %}false{% endif %},
    }
    </script>
    <script type="text/javascript" src="{{ STATIC_URL }}local/player.js"></script>
    <!-- fancy css -->
    <link rel="stylesheet" href="{{ STATIC_URL }}JSONSuggestBox/jsonSuggest.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}local/tipTip.css" />
    <!-- fancy js goes at the bottom (just before </body>) -->
    {% endif %}
    
    {% block extra_head_base %}
        {% block extra_head %}{% endblock %}
    {% endblock %}

    <title>{% else %}<span id="page_title" style"display:none">{% endif %}
    {% block head_title_base %}{% if SITE_NAME %}{{ SITE_NAME }} : {% endif %}{% block head_title %}{% endblock %}{% endblock %}
    {% if request.ajax %}{% if request.modal %}<img src="{{ STATIC_URL }}images/bttn_closepp.png" class="simplemodal-close" />{% endif %}</span>{% else %}</title>
</head>
<body class="{% block body_class %}{% endblock %}">

<div id="html_body_wrapper">

    <div id="topheader">
        <h1>
            <a href="/" id="playlistnow">
                <span>Playistnow</span>
            </a>
        </h1>
        <ul id="menu">
            <li id="topheader_search">
                <a href="{% url music_search %}" class="tiptip" title="Search songs or playlists"></a>
            </li>
        </ul>
        <ul id="menu_right" class="right">
            {% if not request.user.is_authenticated %}
            <li> 
                <a class="button super violet popup" href="{% url acct_login %}">
                  <span class="bigger">Login</span>
                </a>
            </li>
            <li>
                <a class="button super blue" href="#">
                   <span class="bigger">Become Member</span>
                </a>
            </li>
            {% else %}
            You are {{ request.user }}

            <li>
                <a class="button super blue ui_ignore" href="{% url acct_logout %}">
                   <span class="bigger">Logout</span>
                </a>
            </li>

            {% endif %}
        </ul>
    </div>

{% endif %}
{% block body_outer %}
    {% if not request.ajax %}
    <div id="page_body_container">
    {% endif %}
        <div id="page_body_wrapper" class="{% block page_body_wrapper_class %}{% endblock %} page_body_wrapper">
            {% if not request.modal %}
            <div id="page_body_right" class="{% block page_body_right_class %}hidden{% endblock %}">
                {% block body_right %}
                {% endblock %}
            </div>
            <div id="page_body" class="{% block page_body_class %}{% endblock %}">
            {% endif %}
                {% csrf_token %}
                {% block body %}
                <div class="body ajaxload">
                <img src="{{ STATIC_URL }}local/ajax-loader.gif" />
                {% trans "please wait a couple of seconds" %} ...
                </div>

                {% block main_content %}
                {% endblock %}
                
                {% block content %}
                {% endblock %}

                {% endblock %}
            {% if not request.modal %}
            </div>
            {% endif %}
        </div>
    {% if not request.ajax %}
    </div>

    <div id="sidebar">
        {% include "sidebar.html" %}
    </div>
    {% endif %}
{% endblock body_outer %}
{% if not request.ajax %}
</div>

<div id="player">
{% include 'player.html' %}
</div>

<div id="ajaxload">
    <img src="{{ STATIC_URL }}local/ajax-loader.gif" />
    {% trans "loading" %}
</div>

<script src="{{ STATIC_URL }}swfobject/swfobject.js" type="text/javascript"></script>
<script type="text/javascript">
function onYouTubePlayerReady() {
    player.ytplayer = document.getElementById("myytplayer");
    player.ytplayer.setVolume(60);
    setInterval(player.update, 250);
}

var params = { allowScriptAccess: "always" };
var atts = { id: "myytplayer" };
swfobject.embedSWF("http://www.youtube.com/apiplayer?enablejsapi=1&playerapiid=ytplayer", 
                   "ytapiplayer", "0", "0", "8", null, null, params, atts);


    {% if FACEBOOK_APP_ID %}
      <div id="fb-root"></div>
      <script>
      window.fbAsyncInit = function() {
        FB.init({appId: '{{ FACEBOOK_APP_ID }}', status: true, cookie: true, xfbml: true});
        FB.Event.subscribe('auth.sessionChange', function(response) {
          if (response.session) {
              window.location = '{% url socialauth_facebook_login_done %}';
          } else {
              //window.location = '{% url socialauth_social_logout %}';
          }
        });
      };
      (function() {
        var e = document.createElement('script');
        e.type = 'text/javascript';
        e.src = document.location.protocol +
          '//connect.facebook.net/en_US/all.js';
        e.async = true;
        document.getElementById('fb-root').appendChild(e);
      }());
      </script>    
    {% endif %}    
</script>
<div id="ytapiplayer" style="display:none">
    You need Flash player 8+ and JavaScript enabled to enjoy PlaylistNow.Fm.
</div>


{% block extra_body_base %}
    {% block extra_body %}{% endblock %}
{% endblock %}

</body>
</html>
{% endif %}
