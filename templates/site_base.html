{% load i18n cache %}
{% if not request.ajax %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
{% block html_declare %}
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" >
{% endblock %}
<head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <!-- core css -->
    <link rel="stylesheet" href="{{ STATIC_URL }}local/reset.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}local/screen.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}local/prod.css" />
    {% if empty or request.noreload %}
    <!-- core js -->
    <script src="{% block jquery_src %}{{ STATIC_URL }}jquery.min.js{% endblock %}" type="text/javascript"></script>
    <script type="text/javascript">
    {% cache 99999 site_base_js_links %}
    var STATIC_URL = '{{ STATIC_URL }}';
    var music_search_autocomplete = '{% url music_search_autocomplete %}';
    var user_search_autocomplete = '{% url user_search_autocomplete %}';
    var playlist_search_autocomplete = '{% url playlist_search_autocomplete %}';
    var playlist_track_modify = '{% url playlist_track_modify %}';
    var popup_auth = '{% url acct_login %}';
    var music_artist_fanship = '{% url music_artist_fanship %}';
    var action_delete = '{% url action_delete 0 %}';
    var music_badvideo = '{% url music_badvideo %}';
    {% endcache %}
    var tiny_playlist_pk = {% if request.user.is_authenticated %}{{ request.user.playlistprofile.tiny_playlist.pk }}{% else %}0{% endif %};
    </script>
    <script type="text/javascript" src="{{ STATIC_URL }}local/core.js"></script>
    <script type="text/javascript">
    var user = {
        'is_authenticated': {% if request.user.is_authenticated %}true{% else %}false{% endif %},
    }
    </script>
    <script type="text/javascript" src="{{ STATIC_URL }}local/player.js"></script>
    {% if request.user.is_authenticated %}
    <script type="text/javascript">
        player.tiny_playlist = {{ request.user.playlistprofile.tiny_playlist.to_json_dict|safe }};
    </script>
    {% endif %}
    <!-- fancy css -->
    <link rel="stylesheet" href="{{ STATIC_URL }}JSONSuggestBox/jsonSuggest.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}local/tipTip.css" />
    <!-- fancy js goes at the bottom (just before </body>) -->
    {% endif %}
    
    {% block extra_head_base %}
        {% block extra_head %}{% endblock %}
    {% endblock %}

    <title>{% else %}<span id="page_title" style"display:none">{% endif %}
    {% block head_title_base %}{% if SITE_NAME %}{{ SITE_NAME }} : {% endif %}{% block head_title %}{% endblock %}{% endblock %}
    {% if request.ajax %}{% if request.modal %}<img src="{{ STATIC_URL }}images/bttn_closepp.png" class="simplemodal-close" />{% endif %}</span>{% else %}</title>
</head>
<body class="{% block body_class %}{% endblock %}">

<div id="html_body_wrapper">

    <div id="topheader">
        <h1>
            <a href="/" id="playlistnow">
                <span>Playistnow</span>
            </a>
        </h1>
        <ul id="menu">
            <li id="topheader_search">
                <a href="{% url music_search %}" class="tiptip" title="Search songs or playlists"></a>
            </li>
            <li id="topheader_feed">
                <a href="{% url me %}" class="tiptip" title="Friend Feed"></a>
            </li>
        </ul>
        <ul id="menu_right" class="right">
            {% if request.session.socialregistration_user %}
                <li>
                    <a class="button super blue" href="{% url socialregistration_setup %}">
                       <span>Complete registration process</span>
                    </a>
                </li>
            {% else %}
                {% if not request.user.is_authenticated %}
                <li> 
                    <a class="button super violet popup" href="{% url acct_login %}">
                      <span>Login</span>
                    </a>
                </li>
                <li>
                    <a class="button super blue" href="{% url acct_signup %}">
                       <span>Become Member</span>
                    </a>
                </li>
                {% else %}
               <li class="spacing">
                    <a class="ui_ignore" href="{% url acct_logout %}">
                       <span>Logout</span>
                    </a>
                </li>
                <li class="spacing">
                    <a href="{% url notification_notice_settings %}">
                      <span>Settings</span>
                    </a>
                </li>
                <li class="sep">&nbsp;</li>
                {% endif %}
            {% endif %}
            {% if request.user.is_authenticated %}
            
              <li class="spacing"><a href="{% url user_details request.user.username %}">{{ request.user.first_name }} {{ request.user.last_name }}</a>
            </li><li class="spacing_avat">
                <a href="{% url user_details request.user.username %}"><img src="{{ request.user.playlistprofile.avatar_url }}" class="verysmall prof"/></a>
                </li>
              
            <li class="sep">&nbsp;</li>
            <li>
                <a href="{% url playlist_add %}" class="authenticationRequired button super blue">
                    Create a new playlist
                </a>
            </li>
            {% endif %}
        </ul>
    </div>

{% endif %}
{% block body_outer %}    
    {% if not request.ajax %}
    <div id="page_body_container">
    {% endif %}
        <div id="user_notifications_container">
        <ul id="user_notifications">
            {% for message in messages %}
            <li class="{{ message.tags }} delete">
                {{ message|safe }} ({% trans "click to close" %})
            </li>
            {% endfor %}
        </ul>
        </div>
        <div id="page_body_wrapper" class="{% block page_body_wrapper_class %}{% endblock %} page_body_wrapper">
            {% if not request.modal %}
            <div id="page_body_right" class="{% block page_body_right_class %}hidden{% endblock %}">
                {% block body_right %}
                {% endblock %}
            </div>
            <div id="page_body" class="{% block page_body_class %}{% endblock %}">
            {% endif %}
                {% csrf_token %}
                {% block body %}
                <div class="body ajaxload">
                <img src="{{ STATIC_URL }}local/ajax-loader.gif" />
                {% trans "please wait a couple of seconds" %} ...
                </div>

                {% block main_content %}
                {% endblock %}
                
                {% block content %}
                {% endblock %}

                {% endblock %}
            {% if not request.modal %}
            </div>
            {% endif %}
        </div>
    {% if not request.ajax %}
    </div>

    <div id="sidebar">
        {% include "sidebar.html" %}
    </div>
    {% endif %}
{% endblock body_outer %}
{% if not request.ajax %}
</div>

<div id="player">
{% include 'player.html' %}
</div>

<div id="ajaxload">
    <img src="{{ STATIC_URL }}local/ajax-loader.gif" />
    {% trans "loading" %}
</div>
{% if request.noreload %}
<script type="text/javascript">
$(document).ready(function(){ 
    $('#ajaxload').fadeOut();
});
</script>
{% endif %}

<script src="{{ STATIC_URL }}swfobject/swfobject.js" type="text/javascript"></script>
<script type="text/javascript">
/*
function onYouTubePlayerReady() {
    player.ytplayer = document.getElementById("myytplayer");
    player.ytplayer.setVolume(60);
    setInterval(player.update, 250);
}

var params = { allowScriptAccess: "always" };
var atts = { id: "myytplayer" };
swfobject.embedSWF("http://www.youtube.com/apiplayer?enablejsapi=1&playerapiid=ytplayer", 
                   "ytapiplayer", "0", "0", "8", null, null, params, atts);
*/
var tag = document.createElement('script');
tag.src = "http://www.youtube.com/player_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
var done = false;
function onYouTubePlayerAPIReady() {
    player.ytplayer = new YT.Player('iframeplayer', {
      height: '182',
      width: '182',
      videoId: 'JW5meKfy3fY',
      playerVars: { 'controls': 0 },
      events: {
        'onReady': function() {
            player.ytplayer.setVolume(60);
            setInterval(player.update, 500);
        },
        'onStateChange': player.update,
        'onError': player.badVideo,
      }
    });
}   

    {% if request.noreload %}
    $(document).ready(function() {
        $(document).trigger('signalPageUpdate');
    });
    {% endif %}
</script>


{% if FACEBOOK_APP_ID %}
  <div id="fb-root"></div>
  <script>
  window.fbAsyncInit = function() {
    FB.init({appId: '{{ FACEBOOK_APP_ID }}', status: true, cookie: true, xfbml: true});
    FB.Event.subscribe('auth.sessionChange', function(response) {
      if (response.session) {
          window.location = '{% url socialauth_facebook_login_done %}';
      } else {
          //window.location = '{% url socialauth_social_logout %}';
      }
    });
  };
  (function() {
    var e = document.createElement('script');
    e.type = 'text/javascript';
    e.src = document.location.protocol +
      '//connect.facebook.net/en_US/all.js';
    e.async = true;
    document.getElementById('fb-root').appendChild(e);
  }());
  </script>    
{% endif %} 


{% block extra_body_base %}
    {% block extra_body %}{% endblock %}
{% endblock %}

    <script type="text/javascript" src="{{ STATIC_URL }}tipTip/jquery.tipTip.minified.js"></script>
</body>
</html>
{% endif %}
