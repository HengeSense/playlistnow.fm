{% load i18n %}
{% if request.is_ajax %}
{% else %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" >
<head>
    <title>{% block head_title_base %}{% if SITE_NAME %}{{ SITE_NAME }} : {% endif %}{% block head_title %}{% endblock %}{% endblock %}</title>
	<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    
    <link rel="stylesheet" href="{{ STATIC_URL }}JSONSuggestBox/jsonSuggest.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}local/reset.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}local/screen.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}local/prod.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}local/tipTip.css" />
  
    <!--[if lt IE 7]>
    <style media="screen" type="text/css">
    .col1 {
	    width:100%;
	}
    </style>
    <![endif]-->

    {% block extra_head_base %}
        {% block extra_head %}{% endblock %}
    {% endblock %}

    <style type="text/css">
        div.tab {display:none;}
    </style>
</head>
<body class="{% block body_class %}{% endblock %}">

<div id="page_body">
{% endif %}

    <div id="topheader">
        <h1>
            <a href="/" id="playlistnow">
                <span>Playistnow</span>
            </a>
        </h1>
        <ul id="menu">
            <li id="topheader_search">
                <a href="#" class="tiptip" title="Search songs or playlists"></a>
            </li>
        </ul>
        <ul id="menu_right" class="right">
            <li> 
                <a class="button super violet" href="{% url acct_login %}">
                  <span class="bigger">Login</span>
                </a>
            </li>
            <li>
                <a class="button super blue" href="#">
                   <span class="bigger">Become Member</span>
                </a>
            </li>
        </ul>
    </div>


{% block body_outer %}
    <div id="body">
        {% block body %}
        {% endblock %}
    </div>
    
    <div id="sidebar">
        {% include "sidebar.html" %}
    </div>
{% endblock body_outer %}
</div>

{% if request.is_ajax %}
{% else %}
    <div id="player">
    {% include 'player.html' %}
    </div>

<script src="{% block jquery_src %}{{ STATIC_URL }}jquery.min.js{% endblock %}" type="text/javascript"></script>
<script src="{{ STATIC_URL }}swfobject/swfobject.js" type="text/javascript"></script>


<script type="text/javascript">
var player;
function updatePlayerInfo() {
    var all = player.getDuration();
    var part = player.getCurrentTime();
    var partload = player.getVideoBytesLoaded();
    var allload = player.getVideoBytesTotal();
    var percent = getPercent(all, part);
    var percentload = getPercent(allload, partload);
    var timebarWidth = 548;
    var plState = player.getPlayerState();

    document.getElementById('player_progress_bar').style.width = percent * (timebarWidth / 100) + "px";
    document.getElementById('player_loading_bar').style.width = percentload * (timebarWidth / 100) + "px";
    t = Math.round(part);
    var s = t % 60;
    var m = (t - s) / 60;
    if (s < 10)
        s = '0' + s;
    tt = Math.round(all);
    var st = tt % 60;
    var mt = (tt - st) / 60;
    if (st < 10)
        st = '0' + st;
    // Si le player est en buffering on change le temps de lecture par le gif de chargement, sinon on affiche le temps écoulé
    
    
    if(plState!=3)
    {
        document.getElementById('videoCurrentTime').innerHTML = m + ':' + s;
    }else
    {
        document.getElementById('videoCurrentTime').innerHTML = '<img src="images/player_streamin.gif" alt=""  />';
    }
    document.getElementById('videoDuration').innerHTML = mt + ':' + st;// + " state :" + player.getPlayerState();
    
    // Si la song est terminée on passe à la suivante
    if(plState==0)
    {
        if(playerRepeat== false)
        {
        }else
        {
        }
        
    }
   
}
function getPercent(all, part)
{
    return (all > 0) ? (100 / all) * part : 0;
}

function onYouTubePlayerStateChange() {
}
function onYouTubePlayerReady() {
    player = document.getElementById("myytplayer");
}
</script>
<div id="ytapiplayer" style="display:none">
    You need Flash player 8+ and JavaScript enabled to view this video.
</div>

<script type="text/javascript">

var params = { allowScriptAccess: "always" };
var atts = { id: "myytplayer" };
swfobject.embedSWF("http://www.youtube.com/apiplayer?enablejsapi=1&playerapiid=ytplayer", 
                   "ytapiplayer", "0", "0", "8", null, null, params, atts);

</script>

<script type="text/javascript">
$(document).ready(function() {
    $('a:not(".youtube_play")').live('click', function(e) {
        e.preventDefault();
        var url = $(this).attr('href');
    
        $.ajax({
            url: url,
            dataType: 'html',
            success: function(html, textStatus, request) {
                $('#page_body').html(html);
            },
        });
    });
    $('a.youtube_play').live('click', function(e) {
        e.preventDefault();
        var url = $(this).attr('href');
        var id = url.match(/v=([0-9A-Za-z]*)/)[1];

        player.loadVideoById(id);

        var track = $(this).prev();
        var artist = track.prev();
        $('.player_current_artist').html(artist.html());
        $('.player_current_artist').attr('href', artist.attr('href'));
        $('.player_current_track').html(track.html());
        $('.player_current_track').attr('href', track.attr('href'));
        $('.player_bttn_play').hide();
        $('.player_bttn_pause').show();

        if ($('#player').css('display') == 'none') {
            player.addEventListener('onStateChange', onYouTubePlayerStateChange);
            setInterval(updatePlayerInfo, 250);
            $('#player').show();
        }
    });
    $('.player_bttn_stop').click(function() { 
        player.stopVideo(); 
        $('.player_bttn_play').show();
        $('.player_bttn_pause').hide();
    });
    $('.player_bttn_pause').click(function() { 
        player.pauseVideo(); 
        $('.player_bttn_pause').hide();
        $('.player_bttn_play').show();
    });
    $('.player_bttn_play').click(function() { 
        player.playVideo(); 
        $('.player_bttn_play').hide();
        $('.player_bttn_pause').show();
    });
    $('.player_bttn_mute').click(function() {
        player.mute();
    });
    $('ul.tabs li.tab').live('click', function() {
        var tab = $(this).attr('class').match(/tab_[^ ]*/);
        if ($('div.'+tab).css('display') == 'none') {
            $('div.tab').hide();
            $('div.'+tab).show();
            $('li.tab').removeClass('selected');
            $('li.'+tab).addClass('selected');
        }
    });
    $('li.tab:first').addClass('selected');
    $('div.tab:first').fadeIn();
});

</script>

<script src="{{ STATIC_URL }}tipTip/jquery.tipTip.minified.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function() {
    $('.tiptip').tipTip();
});
</script>
{% endif %}

{% block extra_body_base %}
    {% block extra_body %}{% endblock %}
{% endblock %}

{% if request.is_ajax %}
{% else %}
</body>
</html>
{% endif %}
