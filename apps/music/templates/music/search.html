{% extends "music/base.html" %}

{% load i18n %}

{% block head_title %}{% if request.GET.term %}{% trans "Results for" %} {{ request.GET.term }}{% else %}{% trans "Search music" %}{% endif %}{% endblock %}

{% block body %}
<form action="{% url music_search %}" method="get">
    <input type="text" name="term" id="term" />
    <input type="submit" value="{% trans "Search" %}" />
</form>

{% if artists %}
<h2>{% trans "artists matching" %} '{{ request.GET.term }}'</h2>
<ul>
    {% for artist in artists %}
    <li>
        <a href="{{ artist.get_absolute_url }}" title="{% trans "details for artist" %} {{ artist }}">
        {{ artist.name }}
        </a>
    </li>
    {% endfor %}
</ul>
{% endif %}

{% if tracks %}
<h2>{% trans "tracks matching" %} '{{ request.GET.term }}'</h2>
<ul>
    {% for track in tracks %}
    <li>
        <a href="{{ track.get_absolute_url }}" title="{% trans "details for track" %} {{ track }}">
            {{ track.name }}
        </a>
    </li>
    {% endfor %}
</ul>
{% endif %}

{% endblock %}

{% block extra_body %}
<script src="{{ STATIC_URL }}JSONSuggestBox/jquery.jsonSuggest-dev.js" type="text/javascript"></script>

<div id="csrf_token" style="display:none">
{% csrf_token %}
</div>

<script type="text/javascript">
var autocompleteData = [];
var autocompleteRequest;
var autocompleteSettings = {
    minCharacters: 1,
    maxResults: undefined,
    wildCard: "",
    caseSensitive: false,
    notCharacter: "!",
    maxHeight: 350,
    highlightMatches: false,
    onSelect: function(item) {
        window.location.href = item['url'];
    },
    ajaxResults: true,
    width: undefined

};

$('input#term').jsonSuggest(function() {
    if( autocompleteRequest ) {
        autocompleteRequest.abort();
    }

    autocompleteRequest = $.ajax({
        url: '{% url music_search_autocomplete %}?term='+$('input#term').val(),
        dataType: 'json',
        success: function(data) {
            autocompleteData = data;
            autocompleteRequest = false;
        },
        async: false,
    });

    return autocompleteData;
}, autocompleteSettings);

</script>
{% endblock %}
